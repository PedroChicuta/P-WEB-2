<%- include('../partials/header') %>
    <h2>Gerenciar MatrÃ­culas</h2>

    <form action="/matriculas" method="GET" style="margin-bottom: 20px;">
        <label>Filtrar por Status:</label>
        <select name="status" onchange="this.form.submit()" style="width: 200px; display:inline;">
            <option value="">Todos</option>
            <option value="ativa" <%= locals.status === 'ativa' ? 'selected' : '' %>>Ativas</option>
            <option value="trancada" <%= locals.status === 'trancada' ? 'selected' : '' %>>Trancadas</option>
            <option value="concluÃ­da" <%= locals.status === 'concluÃ­da' ? 'selected' : '' %>>ConcluÃ­das</option>
        </select>
    </form>

    <a href="/matriculas/nova" class="btn btn-primary">Nova MatrÃ­cula</a>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Aluno</th>
                <th>Curso</th>
                <th>Data</th>
                <th>Status</th>
                <th>AÃ§Ãµes</th>
            </tr>
        </thead>
        <tbody>
            <% matriculas.forEach(mat => { %>
                <tr>
                    <td><%= mat.id %></td>
                    <td><%= mat.Aluno ? mat.Aluno.nome : mat.alunoId %></td>
                    <td><%= mat.Curso ? mat.Curso.nome : mat.cursoId %></td>
                    <td><%= new Date(mat.data).toLocaleDateString('pt-BR') %></td>
                    
                    <td class="status-<%= mat.status %>"><%= mat.status %></td>
                    
                    <td>
                        <% if(mat.status === 'ativa') { %>
                            <form action="/matriculas/status/<%= mat.id %>" method="POST" style="display:inline">
                                <input type="hidden" name="status" value="concluÃ­da">
                                <button class="btn btn-success" title="Concluir">âœ”</button>
                            </form>
                            <form action="/matriculas/status/<%= mat.id %>" method="POST" style="display:inline">
                                <input type="hidden" name="status" value="trancada">
                                <button class="btn btn-danger" title="Trancar">ðŸ”’</button>
                            </form>
                        <% } %>

                        <form action="/matriculas/delete/<%= mat.id %>" method="POST" style="display:inline"
                              onsubmit="return confirm('Excluir esta matrÃ­cula?');">
                            <button class="btn btn-danger" style="margin-left:5px">X</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>
<%- include('../partials/footer') %>